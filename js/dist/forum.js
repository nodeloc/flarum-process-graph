(()=>{var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const s=flarum.core.compat["common/app"];e.n(s)().initializers.add("nodeloc/flarum-process-graph",(function(){console.log("[nodeloc/flarum-process-graph] Hello, forum and admin!")}));const o=flarum.core.compat["forum/app"];var i=e.n(o);const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/components/UserPage"];var a=e.n(r);function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}flarum.core.compat["common/components/LoadingIndicator"];const c=flarum.core.compat["common/components/Select"];var u=e.n(c),h=function(e){function t(){for(var t,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return(t=e.call.apply(e,[this].concat(o))||this).loading=!0,t.graphData=null,t.graph=null,t.resize_handler_bound=!1,t.upgrade_info=[{gid:19,discussion_start:5,post_count:10,read_permission:10},{gid:20,discussion_start:10,post_count:50,read_permission:20},{gid:21,discussion_start:50,post_count:100,read_permission:50},{gid:22,discussion_start:100,post_count:200,read_permission:100},{gid:23,discussion_start:200,post_count:500,read_permission:150},{gid:24,discussion_start:500,post_count:1e3,read_permission:200},{gid:25,discussion_start:1e4,post_count:1e5,read_permission:666}],t.options={19:"青铜会员",20:"白银会员",21:"黄金会员",22:"钻石会员",23:"王者会员",24:"宗师会员",25:"神仙会员"},t}var s,o;o=e,(s=t).prototype=Object.create(o.prototype),s.prototype.constructor=s,l(s,o);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.loadUser(m.route.param("username")),this.read_permission=this.user.attribute("read_permission"),this.discussionCount=this.user.attribute("discussionCount"),this.commentCount=this.user.attribute("commentCount"),this.user_help_count=this.user.attribute("bestAnswerCount"),this.upgrade_help_count=20,this.left_help_count=this.upgrade_help_count-this.user_help_count>0?this.upgrade_help_count-this.user_help_count:0,this.user_lottery_count=this.user.attribute("lotteryCount"),this.upgrade_lottery_count=20,this.level=0,this.userLevel=0,this.nextLevel="",this.nextPermission=0,this.discussionUpgradeInfo={},this.count_help=0,this.count_lottery=0,this.userLevel=this.determineMembershipLevel(this.discussionCount,this.commentCount),this.discussionUpgradeInfo=0===this.userLevel?this.upgrade_info[0]:this.findUpgradeInfo(this.userLevel),this.nextLevel=this.options[this.discussionUpgradeInfo.gid],this.nextPermission=this.discussionUpgradeInfo.read_permission,this.loadGraph()},n.loadGraph=function(){var e=this;this.loading=!0,i().request({method:"GET",url:i().forum.attribute("apiUrl")+"/process-graph",params:{user_id:this.user.id()}}).then((function(t){e.loading=!1,m.redraw(),e.renderGraph()}))},n.renderGraph=function(){var e=this;if(window.echarts){var t=document.getElementById("process-graph");if(t){var s=document.getElementById("process-graph2");if(s){var o=document.getElementById("process-graph3");if(o){var i=document.getElementById("process-graph4");if(i){var n,r;if(this.chart=this.chart||window.echarts.init(t),this.chart2=this.chart2||window.echarts.init(s),this.chart3=this.chart3||window.echarts.init(o),this.chart4=this.chart4||window.echarts.init(i),this.level&&this.options[this.level]){var a=this.findCurrentInfo(this.level);n=a.discussion_start-this.discussionCount>0?a.discussion_start-this.discussionCount:0,r=a.post_count-this.commentCount>0?a.post_count-this.commentCount:0}else this.discussionUpgradeInfo?(n=this.discussionUpgradeInfo.discussion_start-this.discussionCount>0?this.discussionUpgradeInfo.discussion_start-this.discussionCount:0,r=this.discussionUpgradeInfo.post_count-this.commentCount>0?this.discussionUpgradeInfo.post_count-this.commentCount:0):(n=0,r=0);this.chart.setOption({title:{text:n+"主题",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#009966",align:"center",left:10},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.commentCount,selected:!1,itemStyle:{color:"#009966"}},{value:n,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]}),this.chart2.setOption({title:{text:r+"回复",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#009966",align:"center"},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.discussionCount,selected:!1,itemStyle:{color:"#009966"}},{value:r,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]}),this.chart3.setOption({title:{text:this.left_help_count+"次最佳答案",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#009966",align:"center"},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.user_help_count,selected:!1,itemStyle:{color:"#009966"}},{value:this.left_help_count,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]});var l=this.upgrade_lottery_count-this.user_lottery_count>0?this.upgrade_lottery_count-this.user_lottery_count:0;this.chart4.setOption({title:{text:"发布"+l+"次抽奖",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#009966",align:"center"},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.user_lottery_count,selected:!1,itemStyle:{color:"#009966"}},{value:l,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]}),this.resize_handler_bound||(window.addEventListener("resize",(function(){e.chart.resize(),e.chart2.resize(),e.chart3.resize(),e.chart4.resize()})),this.resize_handler_bound=!0)}}}}}else setTimeout((function(){return e.renderGraph()}),200)},n.determineMembershipLevel=function(e,t){for(var s=this.upgrade_info.length-1;s>=0;s--){var o=this.upgrade_info[s];if(e>=o.discussion_start&&t>=o.post_count)return o.gid}return 0},n.findCurrentInfo=function(e){return this.upgrade_info.find((function(t){return t.gid==e}))},n.findUpgradeInfo=function(e){var t=this.upgrade_info.findIndex((function(t){return t.gid==e}));return t>=0&&t<this.upgrade_info.length-1?this.upgrade_info[t+1]:null},n.content=function(){var e=this;return m("div",{className:"process-graph-page"},m("h2",null,i().translator.trans("nodeloc-process-graph.forum.label.process_graph")),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,i().translator.trans("nodeloc-process-graph.forum.label.total_times",{total:this.read_permission})," ",m("br",null),"下一等级  ",this.nextLevel," ,  阅读权限  ",this.nextPermission),m(u(),{options:this.options,value:this.level,onchange:function(t){e.level=t,e.loadGraph()}})),m("div",{className:"process-graph-container"},m("div",{className:"process-graph-item"},m("div",{id:"process-graph",style:"height: 250px;"})),m("div",{className:"process-graph-item"},m("div",{id:"process-graph2",style:"height: 250px;"}))),m("hr",null),m("h2",null,"乐于助人"),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,"在有求助的标签中回复并被选中为最佳答案为一次助人，20次助人可获得此用户组，用户组权限255")),m("div",{className:"process-graph-container"},m("div",{className:"process-graph-item"},m("div",{id:"process-graph3",style:"height: 250px;"}))),m("hr",null),m("h2",null,"乐善好施"),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,"发布抽奖20次可获得此用户组，用户组权限255")),m("div",{className:"process-graph-container"},m("div",{className:"process-graph-item"},m("div",{id:"process-graph4",style:"height: 250px;"}))))},t}(a());const p=flarum.core.compat["common/components/LinkButton"];var d=e.n(p);i().initializers.add("nodeloc/flarum-process-graph",(function(){i().routes["user.process-graph"]={path:"/u/:username/process-graph",component:h},(0,n.extend)(a().prototype,"navItems",(function(e){e.add("process-graph",d().component({href:i().route("user.process-graph",{username:this.user.username()}),icon:"fas fa-chart-line"},[i().translator.trans("nodeloc-process-graph.forum.label.process_graph")]))}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map