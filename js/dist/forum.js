(()=>{var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const s=flarum.core.compat["common/app"];e.n(s)().initializers.add("nodeloc/flarum-process-graph",(function(){console.log("[nodeloc/flarum-process-graph] Hello, forum and admin!")}));const o=flarum.core.compat["forum/app"];var n=e.n(o);const r=flarum.core.compat["common/extend"],i=flarum.core.compat["forum/components/UserPage"];var a=e.n(i);function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}flarum.core.compat["common/components/LoadingIndicator"];const c=flarum.core.compat["common/components/Select"];var u=e.n(c),p=function(e){function t(){for(var t,s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this).loading=!0,t.graphData=null,t.graph=null,t.resize_handler_bound=!1,t.read_permission=n().session.user.attribute("read_permission"),t.discussionCount=n().session.user.attribute("discussionCount"),t.commentCount=n().session.user.attribute("commentCount"),t.user_help_count=n().session.user.attribute("bestAnswerCount"),t.upgrade_help_count=20,t.left_help_count=t.upgrade_help_count-t.user_help_count>0?t.upgrade_help_count-t.user_help_count:0,t.user_lottery_count=0,t.upgrade_lottery_count=10,t.level=0,t.userLevel=0,t.nextLevel="",t.nextPermission=0,t.discussionUpgradeInfo={},t.count_help=0,t.count_lottery=0,t.upgrade_info=[{gid:19,discussion_start:5,post_count:10,read_permission:0},{gid:20,discussion_start:10,post_count:50,read_permission:20},{gid:21,discussion_start:50,post_count:100,read_permission:50},{gid:22,discussion_start:60,post_count:60,read_permission:100},{gid:23,discussion_start:200,post_count:500,read_permission:120},{gid:24,discussion_start:500,post_count:1e3,read_permission:500}],t.options={19:"青铜会员",20:"白银会员",21:"黄金会员",22:"钻石会员",23:"王者会员",24:"宗师会员"},t}var s,o;o=e,(s=t).prototype=Object.create(o.prototype),s.prototype.constructor=s,l(s,o);var r=t.prototype;return r.oninit=function(t){e.prototype.oninit.call(this,t),this.loadUser(m.route.param("username")),this.userLevel=this.determineMembershipLevel(this.discussionCount,this.commentCount),this.discussionUpgradeInfo=this.findUpgradeInfo(this.userLevel),this.nextLevel=this.options[this.discussionUpgradeInfo.gid],this.nextPermission=this.discussionUpgradeInfo.read_permission,this.loadGraph()},r.loadGraph=function(){var e=this;this.loading=!0,n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/process-graph",params:{user_id:this.user.id()}}).then((function(t){e.loading=!1,e.user_lottery_count=t.total,m.redraw(),e.renderGraph()}))},r.renderGraph=function(){var e=this;if(window.echarts){var t=document.getElementById("process-graph");if(t){var s=document.getElementById("process-graph2");if(s){var o=document.getElementById("process-graph3");if(o){var n=document.getElementById("process-graph4");if(n){var r,i;if(this.chart=this.chart||window.echarts.init(t),this.chart2=this.chart2||window.echarts.init(s),this.chart3=this.chart3||window.echarts.init(o),this.chart4=this.chart4||window.echarts.init(n),this.level&&this.options[this.level]){var a=this.findUpgradeInfo(this.level);r=a.discussion_start-this.discussionCount>0?a.discussion_start-this.discussionCount:0,i=a.post_count-this.commentCount>0?a.post_count-this.commentCount:0}else this.discussionUpgradeInfo?(r=this.discussionUpgradeInfo.discussion_start-this.discussionCount>0?this.discussionUpgradeInfo.discussion_start-this.discussionCount:0,i=this.discussionUpgradeInfo.post_count-this.commentCount>0?this.discussionUpgradeInfo.post_count-this.commentCount:0):(r=0,i=0);this.chart.setOption({title:{text:r+"主题",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#FF974C",align:"center",left:10},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.commentCount,selected:!1,itemStyle:{color:"#FF974C"}},{value:r,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]}),this.chart2.setOption({title:{text:i+"回复",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#FF974C",align:"center"},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.discussionCount,selected:!1,itemStyle:{color:"#FF974C"}},{value:i,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]}),this.chart3.setOption({title:{text:this.left_help_count+"次最佳答案",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#FF974C",align:"center"},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.user_help_count,selected:!1,itemStyle:{color:"#FF974C"}},{value:this.left_help_count,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]});var l=this.upgrade_lottery_count-this.user_lottery_count>0?this.upgrade_lottery_count-this.user_lottery_count:0;this.chart4.setOption({title:{text:"发布"+l+"次抽奖",subtext:"升级还需要",left:"23%",top:"51%",textStyle:{fontWeight:"normal",fontSize:18,color:"#FF974C",align:"center"},subtextStyle:{fontSize:13,color:"#6c7a89"}},legend:{top:20,right:20},series:[{name:"Access From",type:"pie",radius:["70%","80%"],center:["30%","60%"],avoidLabelOverlap:!1,hoverAnimation:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:this.user_lottery_count,selected:!1,itemStyle:{color:"#FF974C"}},{value:l,name:"",itemStyle:{color:"#E9EEF4"},label:{normal:{show:!1}}}]}]}),this.resize_handler_bound||(window.addEventListener("resize",(function(){e.chart.resize(),e.chart2.resize(),e.chart3.resize(),e.chart4.resize()})),this.resize_handler_bound=!0)}}}}}else setTimeout((function(){return e.renderGraph()}),200)},r.determineMembershipLevel=function(e,t){for(var s=e+t,o=this.upgrade_info.length-1;o>=0;o--){var n=this.upgrade_info[o];if(s>=n.discussion_start)return n.gid}return 0},r.findUpgradeInfo=function(e){return this.upgrade_info.find((function(t){return t.gid==e}))},r.content=function(){var e=this;return m("div",{className:"process-graph-page"},m("h2",null,n().translator.trans("nodeloc-process-graph.forum.label.process_graph")),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,n().translator.trans("nodeloc-process-graph.forum.label.total_times",{total:this.read_permission})," ",m("br",null),"下一等级  ",this.nextLevel," ,  阅读权限  ",this.nextPermission),m(u(),{options:this.options,value:this.level,onchange:function(t){e.level=t,e.loadGraph()}})),m("div",{className:"process-graph-container"},m("div",{className:"process-graph-item"},m("div",{id:"process-graph",style:"height: 250px;"})),m("div",{className:"process-graph-item"},m("div",{id:"process-graph2",style:"height: 250px;"}))),m("hr",null),m("h2",null,"乐于助人"),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,"在有求助的标签中回复并被选中为最佳答案为一次助人，20次助人可获得此用户组，用户组权限255")),m("div",{className:"process-graph-container"},m("div",{className:"process-graph-item"},m("div",{id:"process-graph3",style:"height: 250px;"}))),m("hr",null),m("h2",null,"乐善好施"),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,"发布抽奖20次可获得此用户组，用户组权限255")),m("div",{className:"process-graph-container"},m("div",{className:"process-graph-item"},m("div",{id:"process-graph4",style:"height: 250px;"}))))},t}(a());const h=flarum.core.compat["common/components/LinkButton"];var d=e.n(h);n().initializers.add("nodeloc/flarum-process-graph",(function(){n().routes["user.process-graph"]={path:"/u/:username/process-graph",component:p},(0,r.extend)(a().prototype,"navItems",(function(e){e.add("process-graph",d().component({href:n().route("user.process-graph",{username:this.user.username()}),icon:"fas fa-chart-line"},[n().translator.trans("nodeloc-process-graph.forum.label.process_graph")]))}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map